#!/bin/bash
set -euo pipefail
cd "$(dirname "$0")"

if ! [ -f "qa/run-tests.sh" ]; then
    echo "âŒ No test runner. Run ./update-tests first."
    exit 1
fi

mkdir -p developer/reports

cat > status.json <<EOF
{
  "phase": "developing",
  "cycle": 1,
  "max_cycles": 5,
  "last_updated": "$(date -Iseconds)",
  "summary": "Developer working on implementation"
}
EOF

echo "ğŸ’» Opening developer session..."
echo "   They'll write code to make all tests pass."
echo "   You can watch and help."
echo ""

claude --system-prompt "$(cat developer/CLAUDE.md)" \
  --resume "Your goal: make ALL tests pass.

Steps:
1. Read features/*.feature to understand what to build
2. Look at the existing tests to understand what's expected  
3. Write the implementation
4. Run tests with: bash qa/run-tests.sh
5. If tests fail â€” read errors, fix code, run tests again
6. Repeat until ALL tests pass or you're stuck

If you get stuck after several attempts, say so â€” the human will help.
When all tests pass, update status.json phase to 'passed'."
