#!/bin/bash
set -euo pipefail

HATS_DIR="$(cd "$(dirname "$0")" && pwd)"

if ! compgen -G "features/*.feature" > /dev/null 2>&1; then
    echo "No .feature files found. Run ~/.hats/mng first."
    exit 1
fi

mkdir -p designs

cat > status.json <<EOF
{
  "phase": "designing",
  "last_updated": "$(date -Iseconds)",
  "summary": "Designer creating mockups from specs"
}
EOF

if [[ "${1:-}" == "--run" ]]; then
    claude --system-prompt "$(cat "$HATS_DIR/roles/dsgn.md")" \
      --permission-mode acceptEdits \
      -p "Read ALL features/*.feature files and create detailed screen descriptions, wireframes, and UI mockups for every user-facing scenario. Write your output to the designs/ directory."
else
    claude --system-prompt "$(cat "$HATS_DIR/roles/dsgn.md")"
fi
